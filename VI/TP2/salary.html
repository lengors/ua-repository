<!DOCTYPE html>
<html lang="en">

    <head>
        <title>Data Visualization</title>
        <link rel="icon" href="/content/logo.png" style="border-radius: 50%;">

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- BOOTSTRAP START -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <!-- BOOTSTRAP END -->

        <link rel="stylesheet" type="text/css" href="/styles/main.css">
        <link rel="stylesheet" type="text/css" href="/styles/extended.css">
        
        <style>
            .menu {
                max-width: max-content;
            }
        </style>

        <script type="text/javascript" src="https://d3js.org/d3.v5.js"></script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    </head>

    <body class="bg-light">
        <div class="menu bg-light centered-container">
            <div class="pt-2 pb-4 text-center">
                <img class="logo d-block mx-auto mb-4" src="/content/logo.png" alt="Understand Your Salary" width="96" height="72">
                <h2>Understand Your Salary</h2>
            </div>
            <div class="form-group">
                <label for="select">Select</label>
                <select class="form-control" id="select">
                    <option value="salary">Salary Distribution</option>
                    <option value="salaryByRole">Salary Distribution By Role</option>
                    <option value="salaryByExperience">Salary Distribution By Experience</option>
                    <option value="salaryByEducationalBackground">Salary Distribution By Educational Background</option>
                </select>
            </div>
            <div class="row justify-content-center">
                <svg id="barchart" class="bg-light"></svg>
            </div>
        </div>
        <div class="footer"></div>

        <!-- BOOTSTRAP START -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <!-- BOOTSTRAP END -->

        <script type="text/javascript">
            /*let sortOrder = [ 'Less than $20,000', '$20k - $40k', '$40k - $60k', '$60k - $80k', '$80k - $100k',
                '$100k - $120k', '$120k - $140k', '$140k - $160k', '$160k - $180k', '$180k - $200k', '$200k+' ];

            function updateBarChart (barChartId, barChartData) {
                const margin = 60;
                const width = Math.min(900, $(window).width() - margin) - 2 * margin;
                const height = Math.min(900, $(window).width() - margin) - 2 * margin;

                let data = Object.entries(barChartData)
                    .sort((first, second) => sortOrder.indexOf(first[0]) - sortOrder.indexOf(second[0]));

                let keys = data.map(entry => entry[0]);
                let values = data.map(entry => entry[1]);

                d3.selectAll(`#${barChartId} > *`).remove();

                let svg = d3.select(`#${barChartId}`)
                    .attr('width', width + 2 * margin)
                    .attr('height', height + 2 * margin)

                let chart = svg.append('g')
                        .attr('transform', `translate(${margin}, ${margin})`)

                const yScale = d3.scaleLinear()
                    .range([ height, 0 ])
                    .domain([ 0, Math.max(...values) ]);

                chart.append('g')
                    .call(d3.axisLeft(yScale));

                const xScale = d3.scaleBand()
                    .range([ 0, width ])
                    .domain(keys)
                    .padding(0.2);

                chart.append('g')
                    .attr('transform', `translate(0, ${height})`)
                    .call(d3.axisBottom(xScale));

                chart.selectAll()
                    .data(data)
                    .enter()
                    .append('rect')
                        .attr('width', xScale.bandwidth())
                        .attr('x', entry => xScale(entry[0]))
                        .attr('y', entry => yScale(entry[1]))
                        .attr('height', entry => height - yScale(entry[1]));

                svg.append('text')
                    .attr('x', -(height / 2) - margin)
                    .attr('y', margin / 2.4)
                    .attr('transform', 'rotate(-90)')
                    .attr('text-anchor', 'middle')
                    .text('Number of People')

                svg.append('text')
                    .attr('x', width / 2 + margin)
                    .attr('y', height + 2 * margin - 20)
                    .attr('text-anchor', 'middle')
                    .text('Yearly Salary')
            }

            let result = new Object();
            d3.csv('/data_visualization_survey/data/cleaned_survey_results_2019.csv', row => {
                let salariesKey = row['What is your yearly pay?'];
                let educationalBackgroundsKey = row['What is your educational background'];
                let rolesKey = row['Which one of these is the closest to describing your role?'];
                let experiencesKey = row['How many years of experience do you have doing professional data visualization?'];

                if (salariesKey.length != 0) {
                    if (salariesKey in result) {
                        ++result[salariesKey];
                    } else {
                        result[salariesKey] = 1;
                    }
                }
            }).then(() => {
                $(() => {
                    $(window).resize(() => {
                        updateBarChart('barchart', result);
                    }).resize();
                });
            });*/
        </script>
    </body>

</html>